"use strict";(()=>{var e={};e.id=494,e.ids=[494],e.modules={399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},8029:(e,t,s)=>{s.r(t),s.d(t,{originalPathname:()=>j,patchFetch:()=>f,requestAsyncStorage:()=>d,routeModule:()=>c,serverHooks:()=>m,staticGenerationAsyncStorage:()=>l});var r={};s.r(r),s.d(r,{POST:()=>p});var a=s(9303),i=s(8716),o=s(670),n=s(7070),u=s(7857);async function p(e){try{let t="https://zywsedivjfypnzzyoafq.supabase.co",s="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Inp5d3NlZGl2amZ5cG56enlvYWZxIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NzIxNzE5MDEsImV4cCI6MjA4Nzc0NzkwMX0.GnTMzJ9SWUDVaPeCawW_2EETfkHu5LngnUtS9orRIqs";if(!t||!s)return n.NextResponse.json({message:"Server configuration missing"},{status:500});let r=e.headers.get("Authorization"),a=r?.split(" ")[1];if(!a)return n.NextResponse.json({message:"Not authenticated - No token provided"},{status:401});let i=(0,u.eI)(t,s,{global:{headers:{Authorization:`Bearer ${a}`}}}),{data:{user:o},error:p}=await i.auth.getUser();if(p||!o)return console.error("Auth Error:",p),n.NextResponse.json({message:"Not authenticated - Invalid token"},{status:401});let c=await e.json(),{data:d,error:l}=await i.from("jira_configs").select("*").eq("user_id",o.id).single();if(l||!d)return n.NextResponse.json({message:"Jira not configured"},{status:400});let{domain:m,email:j,api_token:f}=d,g=c.projectKey;if(!g)return n.NextResponse.json({message:"Project key is required"},{status:400});let h=c.issueType||"Task",{result:y}=await (async()=>{let e=await fetch(`https://${m}/rest/api/3/issue`,{method:"POST",headers:{Authorization:`Basic ${Buffer.from(`${j}:${f}`).toString("base64")}`,"Content-Type":"application/json",Accept:"application/json"},body:JSON.stringify({fields:{project:{key:g},summary:c.summary,description:{type:"doc",version:1,content:[{type:"paragraph",content:[{type:"text",text:c.description||c.summary}]}]},issuetype:{name:h}}})});if(!e.ok){let t=await e.json();throw{status:e.status,data:t}}return{result:await e.json()}})();return await i.from("jira_configs").update({last_project_key:g}).eq("user_id",o.id),n.NextResponse.json({key:y.key,id:y.id,url:`https://${m}/browse/${y.key}`})}catch(e){if(e.status)return console.error("Jira API Error:",e.data),n.NextResponse.json({message:e.data.errors?Object.values(e.data.errors).join(", "):"Failed to create Jira issue"},{status:e.status});return console.error("Server Error:",e),n.NextResponse.json({message:e.message},{status:500})}}let c=new a.AppRouteRouteModule({definition:{kind:i.x.APP_ROUTE,page:"/api/jira/create-issue/route",pathname:"/api/jira/create-issue",filename:"route",bundlePath:"app/api/jira/create-issue/route"},resolvedPagePath:"/Users/redbar/Documents/GitHub/TofuOS/src/app/api/jira/create-issue/route.ts",nextConfigOutput:"",userland:r}),{requestAsyncStorage:d,staticGenerationAsyncStorage:l,serverHooks:m}=c,j="/api/jira/create-issue/route";function f(){return(0,o.patchFetch)({serverHooks:m,staticGenerationAsyncStorage:l})}}};var t=require("../../../../webpack-runtime.js");t.C(e);var s=e=>t(t.s=e),r=t.X(0,[276,972,857],()=>s(8029));module.exports=r})();