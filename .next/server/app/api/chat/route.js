"use strict";(()=>{var e={};e.id=744,e.ids=[744],e.modules={399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},9226:(e,t,s)=>{s.r(t),s.d(t,{originalPathname:()=>I,patchFetch:()=>g,requestAsyncStorage:()=>d,routeModule:()=>l,serverHooks:()=>h,staticGenerationAsyncStorage:()=>m});var a={};s.r(a),s.d(a,{POST:()=>p});var r=s(9303),n=s(8716),o=s(670),i=s(7070),u=s(1258),c=s(7857);async function p(e){try{let{message:t,sourceIds:s,history:a}=await e.json();if(!t)return i.NextResponse.json({message:"Message is required"},{status:400});let r=process.env.GOOGLE_GEMINI_API_KEY;if(!r)return i.NextResponse.json({content:"I'm currently in Mock Mode because no Gemini API key was found. Once you add your key, I'll be able to analyze your sources in real-time!"});let n="https://zywsedivjfypnzzyoafq.supabase.co",o="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Inp5d3NlZGl2amZ5cG56enlvYWZxIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NzIxNzE5MDEsImV4cCI6MjA4Nzc0NzkwMX0.GnTMzJ9SWUDVaPeCawW_2EETfkHu5LngnUtS9orRIqs",p="No specific sources selected.";if(n&&o&&s&&s.length>0){let e=(0,c.eI)(n,o),{data:t}=await e.from("sources").select("name, type, meta").in("id",s);t&&t.length>0&&(p=`The user has selected the following sources for this conversation:
${t.map(e=>`- ${e.name} (${e.type})`).join("\n")}

Please use this context to answer questions accurately. If the user asks for details about these sources, use your knowledge as a product manager to provide insights based on their types and names.`)}let l=new u.$D(r).getGenerativeModel({model:"gemini-1.5-flash"}).startChat({history:a.map(e=>({role:"assistant"===e.role?"model":"user",parts:[{text:e.content}]})),generationConfig:{maxOutputTokens:1e3}}),d=`Context:
${p}

User Question: ${t}`,m=await l.sendMessage(d),h=await m.response;return i.NextResponse.json({content:h.text()})}catch(e){return console.error("Gemini Chat Error:",e),i.NextResponse.json({message:e.message},{status:500})}}let l=new r.AppRouteRouteModule({definition:{kind:n.x.APP_ROUTE,page:"/api/chat/route",pathname:"/api/chat",filename:"route",bundlePath:"app/api/chat/route"},resolvedPagePath:"/Users/redbar/Documents/GitHub/TofuOS/src/app/api/chat/route.ts",nextConfigOutput:"",userland:a}),{requestAsyncStorage:d,staticGenerationAsyncStorage:m,serverHooks:h}=l,I="/api/chat/route";function g(){return(0,o.patchFetch)({serverHooks:h,staticGenerationAsyncStorage:m})}}};var t=require("../../../webpack-runtime.js");t.C(e);var s=e=>t(t.s=e),a=t.X(0,[276,972,857,258],()=>s(9226));module.exports=a})();